---
title: 'ACSD-66120: [!DNL GraphQL] visualizza percentuali di sconto e prezzi base non corretti quando i prezzi del catalogo includono le imposte'
description: Applica la patch ACSD-66120 per risolvere il problema Adobe Commerce in cui [!DNL GraphQL] visualizza erroneamente le percentuali di sconto e i prezzi base quando i prezzi del catalogo sono configurati per includere le imposte. Questo problema causava discrepanze di arrotondamento, ad esempio mostrare uno sconto del 19,99% invece del 20% previsto.
feature: GraphQL
role: Admin, Developer
type: Troubleshooting
source-git-commit: 237ec3fb5834b4130eee1ce121dfcd2655c851de
workflow-type: tm+mt
source-wordcount: '500'
ht-degree: 0%

---


# ACSD-66120: [!DNL GraphQL] visualizza percentuali di sconto e prezzi base non corretti quando i prezzi del catalogo includono le imposte

La patch di ACSD-66120 risolve il problema in cui [!DNL GraphQL] visualizza erroneamente le percentuali di sconto e i prezzi base quando i prezzi del catalogo sono configurati per includere le imposte. Questo problema causava discrepanze di arrotondamento, ad esempio mostrare uno sconto del 19,99% invece del 20% previsto. Questa patch è disponibile quando è installato [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.70. L’ID della patch è ACSD-66120. Questo problema è pianificato per la risoluzione in Adobe Commerce 2.4.9.

## Prodotti e versioni interessati

**La patch è stata creata per la versione di Adobe Commerce:**

* Adobe Commerce (tutti i metodi di implementazione) 2.4.6-p9

**Compatibile con le versioni di Adobe Commerce:**

* Adobe Commerce (tutti i metodi di implementazione) 2.4.4 - 2.4.8-p2

>[!NOTE]
>
>La patch potrebbe diventare applicabile ad altre versioni con le nuove versioni di [!DNL Quality Patches Tool]. Per verificare se la patch è compatibile con la versione di Adobe Commerce in uso, aggiornare il pacchetto `magento/quality-patches` alla versione più recente e verificare la compatibilità nella pagina [[!DNL Quality Patches Tool]: Cerca patch](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html?lang=it). Utilizza l’ID patch come parola chiave di ricerca per individuare la patch.

## Problema

GraphQL visualizza erroneamente le percentuali di sconto e i prezzi base quando i prezzi di catalogo sono configurati per includere le imposte. A causa di errori di arrotondamento, la percentuale di sconto è pari al 19,99% invece del 20% configurato.

<u>Passaggi da riprodurre</u>:

1. Vai a **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Catalog]** > **[!UICONTROL Catalog]** > **[!UICONTROL Price]**.
1. Imposta **[!UICONTROL Catalog Price Scope]** su *Sito Web*.
1. Vai a **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Sales]** > **[!UICONTROL Tax]** > **[!UICONTROL Calculation Settings]**.
   1. Imposta **[!UICONTROL Tax Calculation Method Based On]** su *Prezzo unitario*.
   1. Imposta **[!UICONTROL Catalog Prices]** su *Imposta inclusa*.
   1. Imposta **[!UICONTROL Apply Discount On Prices]** su *Imposta inclusa*.
1. Vai a **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Sales]** > **[!UICONTROL Tax]** > **[!UICONTROL Default Tax Destination Calculation]**.
   1. Imposta **[!UICONTROL Default Country]** su *Francia*.
1. Vai a **[!UICONTROL Stores]** > **[!UICONTROL Tax Zones and Rates]** > **[!UICONTROL Add new Tax Rate]**.
   1. Immettere un nome nel campo **[!UICONTROL Tax Identifier]**.
   1. Immettere un asterisco (*) nel campo **[!UICONTROL Zip/Post Code]**.
   1. Imposta **[!UICONTROL Country]** su *Francia*.
   1. Immettere *20.000000* nel campo **[!UICONTROL Rate Percent]**.
   1. Fare clic su **[!UICONTROL Save]**.
1. Vai a **[!UICONTROL Stores]** > **[!UICONTROL Tax Rules]** > **[!UICONTROL Add New Tax Rule]**.
   1. Immettere un nome nel campo **[!UICONTROL Name]**.
   1. Imposta **[!UICONTROL Tax Rate]** sulla frequenza aggiunta nel passaggio precedente.
1. Vai a **[!UICONTROL Catalog]** > **[!UICONTROL Products]** > **[!UICONTROL Add Product]**.
   1. Immetti *test* nel campo **[!UICONTROL Product Name]**.
   1. Immetti *test* nel campo **[!UICONTROL SKU]**.
   1. Immettere **82.65** nel campo **[!UICONTROL Price]**.
   1. Imposta **[!UICONTROL Tax Class]** su *Merci tassabili*.
   1. Immettere *100* nel campo **[!UICONTROL Quantity]**.
   1. Fare clic su **[!UICONTROL Save]**.
1. Cambia l&#39;ambito in *Visualizzazione archivio predefinita*.
   1. Annulla impostazione di **[!UICONTROL Use Default Value]** sul prezzo.
   1. Imposta **[!UICONTROL Price]** su *68.87*.
   1. Annulla l&#39;impostazione di **[!UICONTROL Use Default Value]** nella classe fiscale.
   1. Imposta **[!UICONTROL Tax Class]** su *Merci tassabili*. 
   1. Fare clic su **[!UICONTROL Save]**.
1. Vai a **[!UICONTROL Marketing]** > *[!UICONTROL Promotions]* > **[!UICONTROL Catalog Price Rule]** > **[!UICONTROL Add New Rule]**.
   1. Immettere un nome nel campo **[!UICONTROL Rule Name]**.
   1. Imposta **[!UICONTROL Active]** su *Sì*.
   1. Imposta **[!UICONTROL Website]** su *Sito Web principale*.
   1. Imposta **[!UICONTROL Customer Groups]** su *all*
   1. In **[!UICONTROL Actions]**, impostare **[!UICONTROL Apply]** su *Applica come percentuale dell&#39;originale*.
   1. Immettere *20.000000* nel campo **[!UICONTROL Discount Amount]**.
   1. Fare clic su **[!UICONTROL Save]**.
1. Eseguire una reindicizzazione completa:

```
$ bin/magento index:reindex
```

1. Esegui la seguente query [!DNL GraphQL] con **[!UICONTROL Store]**: *default* impostato nelle intestazioni:

```
query{
products(filter: {sku: {eq: "test"}}, sort: {name: ASC}) {
    items {
      name
      sku
      price_range {
        minimum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
        maximum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
      }
    }
  }
}
  
```

<u>Risultati previsti</u>:

La percentuale di sconto deve corrispondere alla regola del catalogo: 20%.

<u>Risultati effettivi</u>:

La percentuale di sconto viene visualizzata erroneamente come 19,99%.

## Applicare la patch

Per applicare singole patch, utilizzare i collegamenti seguenti, a seconda del metodo di distribuzione utilizzato:

* Adobe Commerce o Magento Open Source on-premise: [[!DNL Quality Patches Tool] > Utilizzo](/help/tools/quality-patches-tool/usage.md) nella guida di [!DNL Quality Patches Tool].
* Adobe Commerce su infrastruttura cloud: [Aggiornamenti e patch > Applica patch](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html?lang=it) nella guida Commerce su infrastruttura cloud.

## Lettura correlata

Per ulteriori informazioni su [!DNL Quality Patches Tool], vedere:

* [[!DNL Quality Patches Tool]: strumento self-service per patch di qualità](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) nella guida degli strumenti.
